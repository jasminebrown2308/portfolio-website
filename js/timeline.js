let allData = {"years": [
	{"year": 2022, "events": [
		{"month": 3, "endMonth": 7, "endYear": 2023, "category": ["extra"],
		"title": "ðŸ’ƒ&emsp;Joined Warwick Tap's exec and teaching teams",
		"description": "After being an active member of the society, including being part of our Intermediate competition team, I was elected onto the exec team for 2022-23 as Costumes & Kit Coordinator. My exec role are to coordinate with society members to design, source and distribute kit and costumes. I also teach the All Levels Technical class, where I teach new steps, help to refine technique and come up with fun combinations to practice skills."},
		{"month": 7, "endMonth": 7, "endYear": 2022, "category": ["extra"],
		"title": "ðŸ†&emsp;Named as an MLH Top 50 Hacker",
		"description": "I was named one of MLH's Top 50 Hackers globally in 2022 (out of 150,000+ hackers worldwide). This was in recognition of my contribution to the hacker community through organising WarwickHACK and leading the WarwickTECH guild at MLH's Global Hack Weeks."},
		{"month": 6, "endMonth": 9, "endYear": 2022, "category": ["workexp", "jobs"],
		"title": "ðŸ‘©â€ðŸ’¼&emsp;Interned as an SDE at Amazon",
		"description": "I spent this summer as a Software Development Engineer intern at Amazon in London. My role within Prime Video involved designing and implementing an auditing feature to display changes to video subscription offers. I learnt loads of new skills from this project, including TypeScript and React, AWS cloud infrastructure, NoSQL databases, and APIs."}
	]},
	{"year": 2021, "events": [
		{"month": 9, "endMonth": 4, "endYear": 2022, "category": ["workexp", "extra"],
		"title": "ðŸš€&emsp;Became Principal of WarwickTECH",
		"description": "In my role as Principal, I was responsible for all on-campus activities, primarily the organisation of our first-ever hybrid hackathon, WarwickHACK 2022. I recruited a team of seven students (plus external mentors and judges); secured sponsorship to cover event costs; formed parternships with organisations and societies to help us run the event; and acted as the main point of contact for everyone involved to resolve all queries and issues. We put on a fantastic hackathon, with 210 sign-ups, some super cool projects created during the weekend, and great feedback from our attendees!"},
		{"month": 7, "endMonth": 9, "endYear": 2021, "category": ["workexp", "jobs"],
		"title": "ðŸ“±&emsp;Interned as an app developer at Otium Circle",
		"description": "I learnt to develop native mobile apps for iOS and Android and implemented new features for the startup's app, primarily a magazine to drive community engagement and provide entertainment within the app. Working from a fairly broad initial brief, I designed the front-end, implemented the back-end (using Firebase), incorporated feedback then deployed the feature to app stores. I developed useful skills including collaborative version control, researching new concepts, and debugging a large codebase."},
		{"month": 7, "endMonth": 6, "endYear": 2022, "category": ["workexp", "jobs"],
		"title": "ðŸ‘©â€ðŸ’»&emsp;Started as a Web Assistant at Warwick Students' Union",
		"description": "I've worked on various projects, including developing microsites for key SU events such as Varsity and Welcome Week; co-ordinating the redesign of the Student Voice website section; and improving our election nomination and voting processes. As well as these larger projects, I also provided day-to-day web requests such as updating content and email templates; fixing bugs; and providing technical support to staff and students."},
	]},
	{"year": 2020, "events": [
		{"month": 1, "endMonth": 11, "endYear": 2020, "category": ["jobs"],
		"title": "ðŸ“&emsp;Started Maths tutoring",
		"description": "I was a private GCSE Maths (and sometimes Science) tutor, which involved planning lessons, simplifying and explaining concepts to improve understanding, boosting confidence, and working together to build effective strategies for exams and revision. My Year 11 student improved from a grade 2 to a passing grade 4 within the space of a year, even in spite of the pandemic!"},
		{"month": 9, "endMonth": "", "endYear": "", "category": ["education"],
		"title": "ðŸŽ“&emsp;Joined the University of Warwick",
		"description": "Started my BSc Computer Science degree at Warwick, where I studied modules including Software Engineering, Artificial Intelligence, Data Structures & Algorithms, Web Development and Databases."}
	]},
	{"year": 2019, "events": [
		{"month": 9, "endMonth": 8, "endYear": 2020, "category": ["jobs"],
		"title": "â˜•ï¸&emsp;Began working at Mote Park CafÃ©",
		"description": "While I was in sixth form, I had a part-time job as a CafÃ© Assistant at Mote Park, which involved preparing and serving food and drinks, taking orders and payments on the tills, and keeping the cafÃ© clean, tidy and stocked up. Working as part of a team in hospitality in such a fast-paced environment gave me great communication and customer service skills."},
		{"month": 7, "endMonth": 7, "endYear": 2019, "category": ["workexp"],
		"title": "ðŸ”¥&emsp;Work placement at Firemind",
		"description": "I worked alongside a designer and web developer to create simple web components such as animated forms and navigation bars using HTML, CSS and basic JavaScript. This was only a week-long experience, but it was super exciting as it was my first taste of web development and working at a tech company." }
	]},
	{"year": 2018, "events": [
		{"month": 9, "endMonth": 8, "endYear": 2020, "category": ["education"],
		"title": "ðŸ“˜&emsp;Started A Levels",
		"description": "I took A Levels in Maths, Physics, Computer Science and Further Maths, plus an Extended Project Qualification (EPQ) studying how machine learning can be applied to reduce crime. I achieved grades A*A*A*A plus an A* in my EPQ."},
		{"month": 10, "endMonth": 4, "endYear": 2019, "category": ["workexp"],
		"title": "ðŸ†&emsp;Work placement at Cougar Automation",
		"description": "This was a 6-month work experience placement every Wednesday afternoon where I worked on the SCADA user interface for a water treatment plant and helped to set up Profibus networks as well as helping with various tasks around the office."}
	]},
	{"year": 2017, "events": [
		{"month": 10, "endMonth": 4, "endYear": 2019, "category": ["jobs"],
		"title": "ðŸŽ‚&emsp;Started working at Tiny Town",
		"description": "My first job was working at a children's play centre, where I led children's birthday parties as well as serving customers in the coffee shop and reception."}
	]},
	{"year": 2016, "events": [
		{"month": 10, "endMonth": 6, "endYear": 2017, "category": ["extra"],
		"title": "ðŸ“–&emsp;Volunteered at Madginford Library",
		"description": "I volunteered at my local library as part of my Silver Duke of Edinburgh's Award, where I ran an after-school activity club for primary school children."}
	]},
	{"year": 2015, "events": [
		{"month": 9, "endMonth": 8, "endYear": 2018, "category": ["education"],
		"title": "ðŸ“—&emsp;Started GCSEs",
		"description": "For my GCSEs, I took Maths (9), Biology (9), Chemistry (9), Physics (9), English Language (8), English Literature (7), Computer Science (9), French (9), Geography (9), Textiles Technology (A*) and Level 2 Further Maths (A^)."}
	]},
	{"year": 2013, "events": [
		{"month": 9, "endMonth": 3, "endYear": 2020, "category": ["education"],
		"title": "ðŸ“•&emsp;Joined Invicta Grammar School",
		"description": "Joined my secondary school, where I stayed for 7 years (including sixth form). During my time at Invicta, I was involved in many clubs and activities including music, debating, peer mentoring and Duke of Edinburgh's Awards."}
	]},
	{"year": 2011, "events": [
		{"month": 9, "endMonth": "", "endYear": "", "category": ["extra"],
		"title": "ðŸŽ·&emsp;Started learning saxophone",
		"description": "I started learning to play the alto saxophone in primary school. I continued having lessons for over 7 years until I reached Grade 8, and then kept playing in my school orchestra and Big Band where I performed at many concerts and events."},
	]},
	{"year": 2009, "events": [
		{"month": 9, "endMonth": 7, "endYear": 2017, "category": ["extra"],
		"title": "ðŸ‘¯â€â™€ï¸&emsp;Joined Directions Performing Arts",
		"description": "Started learning Ballet, Tap and Modern (and, later on, Pointe) at Directions. This included performing in shows at the Hazlitt Theatre and other events. I also achieved Grade 5 Tap, Ballet and Modern with Distinctions."}
	]}
]};
let selectedData = allData;

$(function() {
	showCVData(allData, false);
});

// Sort functions - ensures the timeline is ordered no matter what order events are added in
function sortDescYear(obj1, obj2) {
	if (obj1.year > obj2.year) {
		return -1;
	} else if (obj1.year == obj2.year) {
		return 0;
	} else {
		return 1;
	}
}

function sortDescMonth(obj1, obj2) {
	if (obj1.month > obj2.month) {
		return -1;
	} else if (obj1.month == obj2.month) {
		return 0;
	} else {
		return 1;
	}
}

function categorySelect(clicked) {
	selectedData = {"years": []};
	const categories = ["education", "workexp", "jobs", "extra"]
	let selectedCategories = [];
	for (let i = 0; i < 4; i++) {
		if ($("#"+categories[i]+"-checkbox").is(":checked")) { // for each category to show, add all
			selectedCategories.push(categories[i]);
		}
	}
	for (let y = 0; y < allData.years.length; y++) {
		let yearData = allData.years[y];
		let year = yearData.year;
		let yearEvents = [];
		for (let e = 0; e < yearData.events.length; e++) {
			let eventData = yearData.events[e];
			if (eventData.category.filter(value => selectedCategories.includes(value)).length > 0) {
				yearEvents.push(eventData);
			}
		}
		if (yearEvents.length > 0) {
			selectedData.years.push({"year": year, "events": yearEvents});
		}
	}
	$(".year-container").remove();

	showCVData(selectedData, !expand());
}

function showCVData(cvData, showDetails) {
	$("#categories").css("height", $("#cv-download-btn").outerHeight());

	cvData.years.sort(sortDescYear);

	// Iterate through each year in cvData
	for (let y = 0; y < cvData.years.length; y++) {
		let yearData = cvData.years[y];
		let year = yearData.year;
		yearData.events.sort(sortDescMonth);
		$("#years").append("<div class='year-container'><div class='year' id='year"+year+"'><h3>"+year+"</h3></div><div class='content' id='content"+year+"'></div></div>");

		// Iterate through each event in the year
		for (let e = 0; e < yearData.events.length; e++) {
			let eventData = yearData.events[e];
			$("#content"+year).append("<h4 class='event-title' id='"+year+"_"+e+"'>"+eventData.title+"</h4>");
			if (!showDetails) {
				displayDetails(year, e, eventData);
			}

			// Toggle whether description is shown when event title is clicked
			$("#"+year+"_"+e).click(function() {
				if ($("#desc"+year+"_"+e).length) { // if description is shown then hide it
					$("#desc"+year+"_"+e).remove();
					$("#dates"+year+"_"+e).remove();
				}
				else { // if description is hidden then show it
					displayDetails(year, e, eventData);
				}
				updateHeight(year);
			});
		}
		updateHeight(year);
	}

	// Animates the change in height
	if (showDetails) {
		for (let y = 0; y < cvData.years.length; y++) {
			let yearData = cvData.years[y];
			for (let e = 0; e < yearData.events.length; e++) {
				let eventData = yearData.events[e];
				displayDetails(yearData.year, e, eventData);
			}
			updateHeight(yearData.year);
		}
	} else {
		for (let y = 0; y < cvData.years.length; y++) {
			let yearData = cvData.years[y];
			for (let e = 0; e < yearData.events.length; e++) {
				removeDetails(yearData.year);
			}
			updateHeight(yearData.year);
		}
	}
}

function removeDetails(year) {
	$("#content"+year+ " .event-dates").remove();
	$("#content"+year+ " .event-description").remove();
}

function displayDetails(year, e, eventData) {
	$("#"+year+"_"+e).after("<p class='event-description' id='desc"+year+"_"+e+"'>"+eventData.description+"</p>");

	if ((eventData.endYear != year) || (eventData.endMonth != eventData.month)) {
		$("#"+year+"_"+e).after("<p class='event-dates' id='dates"+year+"_"+e+"'>"+dateText(eventData.month, year)+" - "+dateText(eventData.endMonth, eventData.endYear)+"</p>");
	} else { // if event was only one month
		$("#"+year+"_"+e).after("<p class='event-dates' id='dates"+year+"_"+e+"'>"+dateText(eventData.month, year)+"</p>");
	}
}

function updateHeight(year) {
	let height = 0;
	$("#content"+year + " .event-title").each(function() {
		height += $(this).outerHeight() + 20;
	});
	$("#content"+year + " .event-dates").each(function() {
		height += $(this).outerHeight() + 20;
	});
	$("#content"+year + " .event-description").each(function() {
		height += $(this).outerHeight() + 20;
	});

	$("#content"+year).css("height", height+"px");
	$("#year"+year).css("height", height+"px");
}

function toggleExpand() {
	$(".year-container").remove();
	if (expand()) {
		showCVData(selectedData, true);
		$("#expand-arrow").removeClass("fa-chevron-down");
		$("#expand-arrow").addClass("fa-chevron-up");
		$("#expand-txt").html("Hide details");
	} else {
		showCVData(selectedData, false);
		$("#expand-arrow").removeClass("fa-chevron-up");
		$("#expand-arrow").addClass("fa-chevron-down");
		$("#expand-txt").html("Expand all");
	}
}

/* Returns true if the button currently displays the option to 'expand all', otherwise returns false ('hide details') */
function expand() {
	if ($("#expand-arrow").hasClass("fa-chevron-down")) {
		return true;
	} else {
		return false;
	}
}

function dateText(monthNum, year) {
	const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
	if (monthNum == "") return "present";
	return months[monthNum-1] + " " + year;
}
